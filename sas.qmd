---
title: "Analysis of Variance in SAS"
author: "Nicole Harms"
date: "02/16/2026"
date-format: long
image: "sas logo.png"
format: 
  revealjs:
    theme: simple
    slide-number: true
    logo: logo.jpg
---

## What is Analysis of Variance? {.center}

Analysis of Variance (ANOVA) compares the means of some ***dependent variable*** across ***three or more groups*** of an ***independent variable*** to determine if the group means are statistically different.

## When would I use ANOVA? {.center}

You might use ANOVA when...

-   You have a categorical independent variable with three or more factors (levels), and

-   A continuous, dependent variable you are interested in measuring.

## When would I use ANOVA? {.center}

Examples:

-   Comparing three diets, based on how much weight a person lost.

-   Determining if there is a difference in how 10 different medications affect blood pressure.

-   Analyzing the effects of three light levels, fertilizer or not, and their interaction on a plant's growth.

## Example {.center style="font-size: 36px"}

Let's look at an example for how we would run an ANOVA in SAS. Say we have the following scenario:

::: incremental
-   We want to look at how three different light levels (low, medium, high) affect the growth of a plant (in centimeters).

-   In a greenhouse, there are 18 grow lights; six with each light level

-   18 separate plants are randomly assigned to each grow light

-   All other conditions are constant across all plants, and after 12 weeks, total growth is measured
:::

## Example Data {.center}

Say we have the following sample data.

```{r}
#| echo: true
#| eval: false
/* read in data */
data growth;
    input plant $ low med high;
    datalines;
plant1 18.51 19.19 19.23
plant2 5.99	 19.09 24.27	
plant3 12.02 17.90 27.34
plant4 7.06  21.47 22.23
plant5 14.96 20.38 22.92
plant6 13.56 14.58 28.77	
;
run;
```

## Example Data Output {.center}

![](images/growth.png){fig-align="center"}

. . .

Note: This data is in **wide** format, but we'll need it in **long** format in order to analyze it.

## Quick Tip! Reformatting Data {.center}

The Transpose procedure can easily transform our data from wide to long format.

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|2|3|4|"
/* Putting data in long format */
proc transpose data=growth out=growth_long (rename=(col1=growth _name_=light_level));
   by plant;
   var low med high;
run;
```

![](images/growth_long.png){fig-align="center"}

## ANOVA Assumptions {.center}

To use ANOVA, certain assumptions must be met, or results will not be reliable.

::: incremental
-   Data is normally distributed

-   Observations are independent of each other

-   Variances for each group are approximately equal
:::

## ANOVA Assumptions

```{r}
#| fig-align: center

library(ggplot2)

ggplot(data.frame(x = c(0,40)), aes(x = x)) +
  stat_function(fun = dnorm, args = list(mean = 10, sd = 3), color = "#E69F00", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 20, sd = 3), color = "#0072B2", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 30, sd = 3), color = "#CC79A7", linewidth = 1.5) + 
  geom_vline(xintercept = c(10,20,30), 
             color = c("#E69F00","#0072B2","#CC79A7"), 
             linetype = "dashed") +
  geom_text(data = data.frame(
    x = c(12, 22, 32),
    y = c(0.05, 0.05, 0.05),
    label = c("mu[1] == 10", "mu[2] == 20", "mu[3] == 30")),
    aes(x = x, y = y, label = label), parse = TRUE) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.line.y = element_blank())
```

Here, each group is normally distributed with different means and equal variance.

## ANOVA Assumptions

```{r}
#| fig-align: center

ggplot(data.frame(x = c(0,40)), aes(x = x)) +
  stat_function(fun = dnorm, args = list(mean = 10, sd = 3), color = "#E69F00", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 20, sd = 8), color = "#0072B2", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 30, sd = 5), color = "#CC79A7", linewidth = 1.5) + 
  geom_vline(xintercept = c(10,20,30), 
             color = c("#E69F00","#0072B2","#CC79A7"), 
             linetype = "dashed") +
  geom_text(data = data.frame(
    x = c(12, 22, 32),
    y = c(0.06, 0.06, 0.06),
    label = c("mu[1]", "mu[2]", "mu[3]")),
    aes(x = x, y = y, label = label), parse = TRUE) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.line.y = element_blank())
```

Here, groups are normally distributed with different means, but variances are unequal.

## Checking for Normality {.center}

In a general sense, we want to check that our data approximately follows the normal distribution.

```{r}
#| fig-align: center

ggplot(data.frame(x = c(-20,60)), aes(x = x)) +
  stat_function(fun = dnorm, args = list(mean = 20, sd = 12), color = "#0072B2", linewidth = 1.5) +
  geom_vline(xintercept = 20, 
             color = "#0072B2", 
             linetype = "dashed") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.line.y = element_blank())
```

## Checking for Normality {.center}

Let's see if our data looks normal by making a histogram.

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|2|3|"
/* Histogram of growth variable */
proc sgplot data=growth_long;
	histogram growth;
run;
```

## Checking for Normality {.center}

![](images/hist.png){fig-align="center" width="533"}

. . .

Our data looks fairly normal, so we can proceed with an ANOVA. We will assume that the variances are approximately equal.

## How does ANOVA work? {.center}

ANOVA breaks down total variance of the response variable into two components:

::: incremental
-   ***Within*****-group variance:** How much do individual units within a group vary from each other?

-   ***Between*****-group variance:** How much do the different groups vary from each other?
:::

. . .

If ***between-group variance*** is larger, this often suggests that the group means are different.

## ANOVA Hypotheses {.center}

An ANOVA tests the following hypotheses:

::: incremental
-   $H_0:$ All group means are equal.

-   $H_A:$ At least one group mean is different.
:::

. . .

We test these hypotheses with an F-test.

-   If we get a p-value \< 0.05, then we have evidence in favor of $H_A$

## ANOVA In SAS {.center}

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|2|3|4|"
/* Run an ANOVA using proc glm */
proc glm data=growth_long;
   class light_level;
   model growth = light_level;
run;
```

![](images/model1.png){fig-align="center"}

. . .

This output shows us that the model is significant, but we want to look at the individual effect.

## Interpreting the Results {.center}

![](images/effect1.png){fig-align="center"}

-   Here, our p-value is extremely small (0.0002), so we can conclude that at least one of the groups has a different mean.

-   The question remains: which groups are different?

## Tukey's HSD Test {.center style="font-size: 34px"}

Tukey's honestly significant difference (HSD) test allows us to see which groups are significantly different from each other.

-   To run Tukey's HSD test, we simply modify our previous code

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|5|"
/* Tukeys HSD Test */
proc glm data=growth_long;
   class light_level;
   model growth = light_level;
   means light_level / tukey cldiff;
run;
```

Tukey's HSD test will compare every combination of groups and determine which pairs are statistically different from each other.

## Tukey's HSD Test Results {.center}

![](images/tukeys1.png){fig-align="center"}

-   The astrisks in the last column indicate a difference is statistically significant.
-   Here, we see that the low & high and low & medium groups are statiscially different, but not medium & high

## One-Way vs. Two-Way ANOVA {.center}

-   If two *independent categorical variables* need to be analyzed, this is referred to as a *two-way* ANOVA

    -   This can be extended to more than two variables

-   Two-way ANOVA analyzes:

    -   Each independent variable

    -   How they interact (if applicable)

## Two-Way Anova Example {.center}

Consider our original example.

-   Say we have a second independent variable to analyze.

-   Now we also want to see if the presence of fertilizer or not affects plant growth.

-   We also want to see if it interacts with light level.

## New Data Set {.center}

```{r}
#| echo: true
#| eval: false
/* New data set */
data growth2;
    input plant $ fertilizer $ low med high;
    datalines;
plant1 Y 18.51 19.19 19.23
plant2 N 5.99  19.09 24.27	
plant3 Y 12.02 17.90 27.34
plant4 N 7.06  21.47 22.23
plant5 Y 14.96 20.38 22.92
plant6 N 13.56 14.58 28.77	
;
run;

proc transpose data=growth2 out=growth_long2 (rename=(col1=growth _name_=light_level));
   by plant fertilizer;
   var low med high;
run;
```

## New Data Set {.center}

![](images/growth_long2.png){fig-align="center"}

## Two-Way ANOVA in SAS {.center}

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|3|4|"
/* Run a two-way ANOVA with proc glm */
proc glm data=growth_long2 order=data;
   class light_level fertilizer;
   model growth = light_level fertilizer light_level*fertilizer;
run;
```

![](images/model2.png){fig-align="center"}

## Two-Way ANOVA in SAS {.center}

![](images/effect2.png){fig-align="center"}

-   "light_lev\*fertilizer" gives the analysis for the interaction.

-   The p-value for the interaction is 0.143, meaning the interaction between light level and fertilizer is not statistically significant.

## Caution in the face of interaction! {.center}

-   Even if interaction is not determined statistically significant via an ANOVA, results still need to be looked at with caution

    -   Interaction may still be present *even if it is not statistically significant.*

    -   Individual effects may not have meaning, even if interaction is not significant.

-   A useful tool is an **interaction plot**

-   This helps us visualize how two effects (variables) are related.

## Interaction Plot: No Interaction {.center}

```{r}
inter <- data.frame(A = rep(c("A1","A2"),each = 2),
                    B = rep(c("B1","B2"),2),
                    Data = c(12,13,14,15))

interaction.plot(x.factor = inter$A,
                 trace.factor = inter$B, 
                 response = inter$Data, fun = mean,
                 xlab = "Effect A", ylab = "Data", trace.label = "Effect B",
                 col = c("red","blue"), lty = 1, pch = 2)
```

## Interaction Plot: Interaction is Present {.center}

```{r}
inter1 <- data.frame(A = rep(c("A1","A2"),each = 2),
                    B = rep(c("B1","B2"),2),
                    Data = c(11,12,13,17))
inter2 <- data.frame(A = rep(c("A1","A2"),each = 2),
                    B = rep(c("B1","B2"),2),
                    Data = c(12,14,15,13))

par(mfrow = c(1,2))
interaction.plot(x.factor = inter1$A,
                 trace.factor = inter1$B, 
                 response = inter1$Data, fun = mean,
                 xlab = "Effect A", ylab = "Data", trace.label = "Effect B",
                 col = c("red","blue"), lty = 1, pch = 2)
interaction.plot(x.factor = inter2$A,
                 trace.factor = inter2$B, 
                 response = inter2$Data, fun = mean,
                 xlab = "Effect A", ylab = "Data", trace.label = "Effect B",
                 col = c("red","blue"), lty = 1, pch = 2)
```

Both plots indicate interaction is present.

## Creating an Interaction Plot in SAS {.center}

The GLM Procedure automatically generates an interaction plot as part of its output.

![](images/interaction1.png){fig-align="center"}

. . .

Here, we can see there is some sort of interaction going on.

## Creating an Interaction Plot in SAS {.center}

Often, it is helpful to switch the axes. We can generate a new interaction plot by modifying our existing code and using the PLM procedure.

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|5|8|9|"
/* Generate an interaction plot with flipped axes */
proc glm data=growth_long2 order=data;
   class light_level fertilizer;
   model growth = light_level fertilizer light_level*fertilizer;
   store twoway;
run;

proc plm restore=twoway;
    effectplot interaction(x=fertilizer sliceby=light_level);
run;
```

## Creating an Interaction Plot in SAS {.center}

Here, the interaction is not as noticeable.

![](images/interaction2.png){fig-align="center"}

. . .

Moral of the story: always look at your data in more ways than one!

## Tukey's HSD Test for Two-Way ANOVA {.center}

Tukey's HSD test can also be used with a two-way ANOVA.

```{r}
#| echo: true
#| eval: false
/* Run a two-way ANOVA with proc glm */
proc glm data=growth_long2 order=data;
   class light_level fertilizer;
   model growth = light_level fertilizer light_level*fertilizer;
   means light_level fertilizer/ tukey cldiff;
run;
```

I didn't include the output here, because it is long!

-   Tukey's HSD test can give great further insight, especially when your interaction is significant

## Other ANOVA Notes... {.center style="font-size: 30px"}

::: incremental
-   If you ever encounter a scenario where error degrees of freedom are equal to or smaller than any main effect or interaction, ANOVA results won't be reliable.

-   If you are ever worried that variances between groups aren't equal, adding the line `means group_variable / hovtest=levene(type=abs);` to the GLM procedure will test for equality of variances.

    -   \*Note that `group_variable` is arbitrary, replace with your grouping variable's name

-   If you have a scenario where you have an **unbalanced** experiment or missing data points, you'll want to rely on results from an ANOVA using **Type III sums of squares**.

    -   The GLM procedure gives both **Type I** and **Type III** sums of squares analyses.

    -   If your design is **balanced**, Type I and Type III outputs will be the same.
:::