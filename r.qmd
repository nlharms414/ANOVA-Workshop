---
title: "Analysis of Variance in R"
author: "Nicole Harms"
date: "02/09/2026"
date-format: long
image: "r logo.jpeg"
format: 
  revealjs:
    theme: simple
    slide-number: true
    logo: logo.jpg
---

## What is Analysis of Variance? {.center}

Analysis of Variance (ANOVA) compares the means of some ***dependent variable*** across ***three or more groups*** of an ***independent variable*** to determine if the group means are statistically different.

## When would I use ANOVA? {.center}

You might use ANOVA when...

-   You have a categorical independent variable with three or more factors (levels), and

-   A continuous, dependent variable you are interested in measuring.

## When would I use ANOVA? {.center}

Examples:

-   Comparing three diets, based on how much weight a person lost.

-   Determining if there is a difference in how 10 different medications affect blood pressure.

-   Analyzing the effects of three light levels, fertilizer or not, and their interaction on a plant's growth.

## Example {.center style="font-size: 36px"}

Let's look at an example for how we would run an ANOVA in R. Say we have the following scenario:

::: incremental
-   We want to look at how three different light levels (low, medium, high) affect the growth of a plant (in centimeters).

-   In a greenhouse, there are 18 grow lights; six with each light level

-   18 separate plants are randomly assigned to each grow light

-   All other conditions are constant across all plants, and after 12 weeks, total growth is measured
:::

## Example Data {.center}

Say we have the following sample data.

```{r}
#| echo: true
# Reading in data
growth <- data.frame(plant = c("plant 1","plant 2","plant 3","plant 4","plant 5","plant 6"),
                     low = c(18.51,5.99,11.02,7.06,14.96,13.56),
                     med = c(19.19,19.09,17.90,21.47,20.38,14.58),
                     high = c(19.23,24.27,27.34,22.23,22.92,28.77))
growth
```

. . .

Note: This data is in **wide** format, but we'll need it in **long** format in order to analyze it.

## Quick Tip! Reformatting Data {.center}

The `pivot_longer()` function from the `tidyr` package easily converts data from **wide** format to **long** format.

. . .

Install the package (if you haven't already) by pasting the following code into your console.

```{r}
#| echo: true
#| eval: false
install.packages("tidyr")
```

## Quick Tip! Reformatting Data {.center}

Next, use `pivot_longer()` to restructure the data.

```{r}
#| echo: true
#| code-line-numbers: "|3|4|5|6|"
# Putting data in long format
library(tidyr)
growth_long <- pivot_longer(data = growth,
                            cols = "low":"high",
                            names_to = "light_level",
                            values_to = "growth")
head(growth_long)
```

## ANOVA Assumptions {.center}

To use ANOVA, certain assumptions must be met, or results will not be reliable.

::: incremental
-   Data is normally distributed

-   Observations are independent of each other

-   Variances for each group are approximately equal
:::

## ANOVA Assumptions

```{r}
#| fig-align: center

library(ggplot2)

ggplot(data.frame(x = c(0,40)), aes(x = x)) +
  stat_function(fun = dnorm, args = list(mean = 10, sd = 3), color = "#E69F00", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 20, sd = 3), color = "#0072B2", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 30, sd = 3), color = "#CC79A7", linewidth = 1.5) + 
  geom_vline(xintercept = c(10,20,30), 
             color = c("#E69F00","#0072B2","#CC79A7"), 
             linetype = "dashed") +
  geom_text(data = data.frame(
    x = c(12, 22, 32),
    y = c(0.05, 0.05, 0.05),
    label = c("mu[1] == 10", "mu[2] == 20", "mu[3] == 30")),
    aes(x = x, y = y, label = label), parse = TRUE) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.line.y = element_blank())
```

Here, each group is normally distributed with different means and equal variance.

## ANOVA Assumptions

```{r}
#| fig-align: center

ggplot(data.frame(x = c(0,40)), aes(x = x)) +
  stat_function(fun = dnorm, args = list(mean = 10, sd = 3), color = "#E69F00", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 20, sd = 8), color = "#0072B2", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 30, sd = 5), color = "#CC79A7", linewidth = 1.5) + 
  geom_vline(xintercept = c(10,20,30), 
             color = c("#E69F00","#0072B2","#CC79A7"), 
             linetype = "dashed") +
  geom_text(data = data.frame(
    x = c(12, 22, 32),
    y = c(0.06, 0.06, 0.06),
    label = c("mu[1]", "mu[2]", "mu[3]")),
    aes(x = x, y = y, label = label), parse = TRUE) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.line.y = element_blank())
```

Here, groups are normally distributed with different means, but variances are unequal.

## Checking for Normality {.center}

In a general sense, we want to check that our data approximately follows the normal distribution.

```{r}
#| fig-align: center

ggplot(data.frame(x = c(-20,60)), aes(x = x)) +
  stat_function(fun = dnorm, args = list(mean = 20, sd = 12), color = "#0072B2", linewidth = 1.5) +
  geom_vline(xintercept = 20, 
             color = "#0072B2", 
             linetype = "dashed") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.line.y = element_blank())
```

## Checking for Normality {.center}

Let's see if our data looks normal by making a histogram.

```{r}
#| echo: true
#| fig-align: center
hist(growth_long$growth)
```

. . .

Our data looks fairly normal, so we can proceed with an ANOVA. We will assume that the variances are approximately equal.

## How does ANOVA work? {.center}

ANOVA breaks down total variance of the response variable into two components:

::: incremental
-   ***Within*****-group variance:** How much do individual units within a group vary from each other?

-   ***Between*****-group variance:** How much do the different groups vary from each other?
:::

. . .

If ***between-group variance*** is larger, this often suggests that the group means are different.

## ANOVA Hypotheses {.center}

An ANOVA tests the following hypotheses:

::: incremental
-   $H_0:$ All group means are equal.

-   $H_A:$ At least one group mean is different.
:::

. . .

We test these hypotheses with an F-test.

-   If we get a p-value \< 0.05, then we have evidence in favor of $H_A$

## ANOVA In R {.center}

```{r}
#| echo: true
#| code-line-numbers: "|2|3|"
# Run an ANOVA
model <- aov(growth ~ light_level, data = growth_long)
summary(model)
```

## Interpreting the Results {.center}

```{r}
model <- aov(growth ~ light_level, data = growth_long)
anova(model)
```

-   `Pr(>F)`: This is the p-value from the F-test for `light_level`

-   Here, our p-value is extremely small, so we can conclude that at least one of the groups has a different mean.

-   The question remains: which groups are different?

## Tukey's HSD Test {.center}

Tukey's honestly significant difference (HSD) test allows us to see which groups are significantly different from each other.

```{r}
#| echo: true
#| eval: false
# Tukey's HSD test
TukeyHSD(model, conf.level = 0.95) # default to 95% confidence
``` 

Tukey's HSD test will compare every combination of groups and determine which pairs are statistically different from each other.

## Tukey's HSD Test Results {.center}

```{r}
TukeyHSD(model, conf.level = 0.95) # default to 95% confidence
``` 

-   `diff` gives the difference in means for the two groups
-   `p adj` gives the p-value for the difference in two groups
-   Here, we see that the low & high and low & medium groups are statiscially different, but not medium & high 

## One-Way vs. Two-Way ANOVA {.center}

-   If two *independent categorical variables* need to be analyzed, this is referred to as a *two-way* ANOVA

    -   This can be extended to more than two variables

-   Two-way ANOVA analyzes:

    -   Each independent variable

    -   How they interact (if applicable)

## Two-Way Anova Example {.center}

Consider our original example.

-   Say we have a second independent variable to analyze.

-   Now we also want to see if the presence of fertilizer or not affects plant growth.

-   We also want to see if it interacts with light level.

## New Data Set {.center}

```{r}
#| echo: true
growth2 <- data.frame(plant = c(1:6),
                     fertilizer = rep(c("Y","N"),each=3),
                     low = c(18.51,5.99,12.02,7.06,14.96,13.56),
                     med = c(19.19,19.09,17.90,21.47,20.38,14.58),
                     high = c(19.23,24.27,27.34,22.23,22.92,28.77))
growth_long2 <- pivot_longer(data = growth2,
                            cols = "low":"high",
                            names_to = "light_level",
                            values_to = "growth")
head(growth_long2)
```

## Two-Way ANOVA in R {.center}

```{r}
#| echo: true
#| code-line-numbers: "|2|"
# Run a two-way ANOVA
model2 <- aov(growth ~ light_level*fertilizer, data = growth_long2)
summary(model2)
```

-   `light_level:fertilizer` gives the analysis for the interaction.

-   The p-value for the interaction is 0.915, indicating there is no evidence of an interaction between fertilizer and light level.

## Caution in the face of interaction! {.center}

-   If interaction is determined statistically significant via an ANOVA, then generally we cannot make any assumptions about the individual effects

    -   Even if your individual effects show as significant, heed those results with caution if the interaction is significant

-   A useful tool is an **interaction plot**

-   This helps us visualize how two effects (variables) are related.

## Interaction Plot: No Interaction {.center}

```{r}
inter <- data.frame(A = rep(c("A1","A2"),each = 2),
                    B = rep(c("B1","B2"),2),
                    Data = c(12,13,14,15))

interaction.plot(x.factor = inter$A,
                 trace.factor = inter$B, 
                 response = inter$Data, fun = mean,
                 xlab = "Effect A", ylab = "Data", trace.label = "Effect B",
                 col = c("red","blue"), lty = 1, pch = 2)
```

## Interaction Plot: Interaction is Present {.center}

```{r}
inter1 <- data.frame(A = rep(c("A1","A2"),each = 2),
                    B = rep(c("B1","B2"),2),
                    Data = c(11,12,13,17))
inter2 <- data.frame(A = rep(c("A1","A2"),each = 2),
                    B = rep(c("B1","B2"),2),
                    Data = c(12,14,15,13))

par(mfrow = c(1,2))
interaction.plot(x.factor = inter1$A,
                 trace.factor = inter1$B, 
                 response = inter1$Data, fun = mean,
                 xlab = "Effect A", ylab = "Data", trace.label = "Effect B",
                 col = c("red","blue"), lty = 1, pch = 2)
interaction.plot(x.factor = inter2$A,
                 trace.factor = inter2$B, 
                 response = inter2$Data, fun = mean,
                 xlab = "Effect A", ylab = "Data", trace.label = "Effect B",
                 col = c("red","blue"), lty = 1, pch = 2)
```

Both plots indicate interaction is present.

## Creating an Interaction Plot {.center}

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|2|3|4|5|6"
#| fig-align: center
# Interaction plot for light level and fertilizer
interaction.plot(x.factor = growth_long2$fertilizer,
                 trace.factor = growth_long2$light_level, 
                 response = growth_long2$growth, fun = mean,
                 xlab = "Fertilizer", ylab = "Growth (cm)", trace.label = "Light Level",
                 col = c("#E69F00","#0072B2","#CC79A7"), lty = 1)
```

## Creating an Interaction Plot {.center}

```{r}
interaction.plot(x.factor = growth_long2$fertilizer,
                 trace.factor = growth_long2$light_level, 
                 response = growth_long2$growth, fun = mean,
                 xlab = "Fertilizer", ylab = "Growth (cm)", trace.label = "Light Level",
                 col = c("#E69F00","#0072B2","#CC79A7"), lty = 1)
```

This interaction plot shows little to no interaction between fertilizer and light level, which was confirmed by the ANOVA.

## Tukey's HSD Test for Two-Way ANOVA {.center}

Tukey's HSD test can also be used with a two-way ANOVA.

```{r}
#| echo: true
#| eval: false
# Tukey's HSD test for a two-way ANOVA
TukeyHSD(model2, conf.level = 0.95)
```

I didn't include the output here, because it is long!

-   Tukey's HSD test can give great further insight, especially when your interaction is significant

## Other ANOVA Notes... {.center style="font-size: 32px"}

-   If you ever encounter a scenario where `residual` degrees of freedom (`df`) are equal to or smaller than any main effect or interaction, ANOVA results won't be reliable

-   If you are ever worried that variances between groups aren't equal, the `leveneTest()` function can test for equality of variances

-   If you have a scenario where you have an **unbalanced** experiment or missing data points, **Type III sums of squares** should be used in the ANOVA.

    -   The `aov()` function we used uses **Type I sums of squares**.
    
    -   The library `car` has an `Anova()` function with Type III capabilities.

