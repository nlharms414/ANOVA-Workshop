---
title: "Analysis of Variance in R"
author: "Nicole Harms"
date: "02/09/2026"
date-format: long
format: 
  revealjs:
    theme: simple
    slide-number: true
    logo: logo.jpg
---

# Intro. to Analysis of Variance

## What is Analysis of Variance? {.center}

Analysis of Variance (ANOVA) compares the means of some ***dependent variable*** across ***three or more groups*** of an ***independent variable*** to determine if the group means are statistically different. 

## When would I use ANOVA? {.center}

You might use ANOVA when...

-   You have a categorical independent variable with three or more factors (levels), and

-   A continuous, dependent variable you are interested in measuring.

## When would I use ANOVA? {.center}

Examples:

-   Comparing three diets, based on how much weight a person lost.

-   Determining if there is a difference in how 10 different medications affect blood pressure.

-   Analyzing the effects of three light levels, fertilizer or not, and their interaction on a plant's growth.

## Example {.center}

Let's look at an example for how we would run an ANOVA in R. Say we have the following scenario:

::: incremental
-   We want to look at how three different light levels (low, medium, high) affect the growth of a plant (in centimeters).

-   In a greenhouse, six plants are grown under each light level (each in their own pot) for a total of 18 plants in the experiment.

-   All other conditions are constant across all plants, and after 12 weeks, total growth is measured
:::

## Example Data {.center}

Say we have the following sample data.

```{r}
#| echo: true
# Reading in data
growth <- data.frame(plant = c("plant 1","plant 2","plant 3","plant 4","plant 5","plant6"),
                     low = c(18.51,5.99,7.06,14.02,14.96,13.56),
                     medium = c(19.19,19.09,17.90,21.47,20.38,14.58),
                     high = c(19.23,24.27,27.34,22.23,22.92,28.77))
growth
```

. . .

Note: This data is in **wide** format, but we'll need it in **long** format in order to analyze it.

## Quick Tip! Reformatting Data {.center}

The `pivot_longer()` function from the `tidyr` package easily converts data from **wide** format to **long** format. 

. . .

Install the package (if you haven't already) by pasting the following code into your console.

```{r}
#| echo: true
#| eval: false
install.packages("tidyr")
```

## Quick Tip! Reformatting Data {.center}

Next, use `pivot_longer()` to restructure the data.

```{r}
#| echo: true
#| code-line-numbers: "|3|4|5|6|"
# Putting data in long format
library(tidyr)
growth_long <- pivot_longer(data = growth,
                            cols = "low":"high",
                            names_to = "light_level",
                            values_to = "growth")
head(growth_long)
```


## ANOVA Assumptions {.center}

To use ANOVA, certain assumptions must be met, or results will not be reliable.

::: incremental
-   Data is normally distributed

-   Observations are independent of each other

-   Variances for each group are approximately equal
:::

## ANOVA Assumptions

```{r}
#| fig-align: center

library(ggplot2)

ggplot(data.frame(x = c(0,40)), aes(x = x)) +
  stat_function(fun = dnorm, args = list(mean = 10, sd = 3), color = "#E69F00", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 20, sd = 3), color = "#0072B2", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 30, sd = 3), color = "#CC79A7", linewidth = 1.5) + 
  geom_vline(xintercept = c(10,20,30), 
             color = c("#E69F00","#0072B2","#CC79A7"), 
             linetype = "dashed") +
  geom_text(data = data.frame(
    x = c(12, 22, 32),
    y = c(0.05, 0.05, 0.05),
    label = c("mu[1]", "mu[2]", "mu[3]")),
    aes(x = x, y = y, label = label), parse = TRUE) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.line.y = element_blank())
```

Here, each group is normally distributed with different means and equal variance.

## ANOVA Assumptions

```{r}
#| fig-align: center

ggplot(data.frame(x = c(0,40)), aes(x = x)) +
  stat_function(fun = dnorm, args = list(mean = 10, sd = 3), color = "#E69F00", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 20, sd = 8), color = "#0072B2", linewidth = 1.5) +
  stat_function(fun = dnorm, args = list(mean = 30, sd = 5), color = "#CC79A7", linewidth = 1.5) + 
  geom_vline(xintercept = c(10,20,30), 
             color = c("#E69F00","#0072B2","#CC79A7"), 
             linetype = "dashed") +
  geom_text(data = data.frame(
    x = c(12, 22, 32),
    y = c(0.06, 0.06, 0.06),
    label = c("mu[1]", "mu[2]", "mu[3]")),
    aes(x = x, y = y, label = label), parse = TRUE) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.line.y = element_blank())
```

Here, groups are normally distributed with different means, but variances are unequal.

## Checking for Normality {.center}

In a general sense, we want to check that our data approximately follows the normal distribution.

```{r}
#| fig-align: center

ggplot(data.frame(x = c(-20,60)), aes(x = x)) +
  stat_function(fun = dnorm, args = list(mean = 20, sd = 12), color = "#0072B2", linewidth = 1.5) +
  geom_vline(xintercept = 20, 
             color = "#0072B2", 
             linetype = "dashed") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.line.y = element_blank())
```

## Checking for Normality {.center}

Let's see if our data looks normal by making a histogram.

```{r}
#| fig-align: center
hist(growth_long$growth)
```

. . .

Our data looks fairly normal, so we can proceed with an ANOVA. We will assume that the variances are approximately equal.

## How does ANOVA work? {.center}

ANOVA breaks down total data set variance into two components:

:::{.incremental}
-   ***Within*****-group variance:** How much do individual units within a group vary from each other?

-   ***Between*****-group variance:** How much do the different groups vary from each other?
:::

. . .

If ***between-group variance*** is larger, this often suggests that the group means are different.

## ANOVA Hypotheses {.center}

An ANOVA tests the following hypotheses:

::: incremental 
-   $H_0:$All group means are equal.

-   $H_A:$At least one group mean is different.
:::

. . . 

We test these hypotheses with an F-test.

-   If we get a p-value < 0.05, then we have evidence in favor of $H_A:$

## ANOVA In R {.center}

```{r}
#| echo: true
#| code-line-numbers: "|2|3|"
# Run an ANOVA
model <- lm(growth ~ light_level, data = growth_long)
anova(model)
```

## One-Way vs. Two-Way ANOVA {.center}

-   If two *independent categorical variables* need to be analyzed, this is referred to as a *two-way* ANOVA

    -   This can be extended to more than two variables
    
-   Two-way ANOVA analyzes:

    -   Each independent variable
    
    -   How they interact (if applicable)
    
## Two-Way Anova Example {.center}

Consider our original example. 

-   Say we have a second independent variable to analyze.

-   Now we also want to see if the presence of fertilizer or not affects plant growth.

-   We also want to see if it interacts with light level.

## New Data Set {.center}

```{r}
growth2 <- data.frame(plant = c(1:6),
                     fertilizer = rep(c("Y","N"),3),
                     low = c(18.51,5.99,7.06,14.02,14.96,13.56),
                     medium = c(19.19,19.09,17.90,21.47,20.38,14.58),
                     high = c(19.23,24.27,27.34,22.23,22.92,28.77))
growth_long2 <- pivot_longer(data = growth2,
                            cols = "low":"high",
                            names_to = "light_level",
                            values_to = "growth")
head(growth_long2)
```

## Two-Way ANOVA in R {.center}

```{r}
#| echo: true
#| code-line-numbers: "|2|3|"
# Run a two-way ANOVA
model2 <- lm(growth ~ light_level*fertilizer, data = growth_long2)
anova(model2)
```

## Sums of Squares: Which to use? {.center}

-   Multiple sums of squares methods exist

-   The type of sums of squares you use depends on your scenario

-   The previous examples used Type I sums of squares

-   If you have **unbalanced** data, you'll want to use Type III sums of squares


